<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>早押しクイズ 親機</title>
</head>

<body>
  <h1>早押しクイズ 親機</h1>
  <button id="startConnection">接続開始</button>
  <button id="correctButton">正解</button>
  <button id="wrongButton">不正解</button>
  <button id="resetButton">リセット</button>
  <p id="status"></p>

  <audio id="correctSound" src="assets/audio/correct1.mp3"></audio>
  <audio id="wrongSound" src="assets/audio/Quiz-Wrong_Buzzer02-1.mp3"></audio>

  <script>
    let ws;
    let buzzerPressed = false; // 早押しボタンが押されたかどうかの状態

    document.getElementById("startConnection").onclick = () => {
      ws = new WebSocket("wss://hayaoshi-quiz-backend.onrender.com");
      ws.onopen = () => {
        document.getElementById("status").textContent = "接続成功";
      };
      ws.onmessage = (message) => {
        const data = JSON.parse(message.data);
        if (data.type === "buzzerPressed" && !buzzerPressed) {
          buzzerPressed = true;
          // 誰かが早押ししたらリセットするまで次の早押しは受け付けない
        }
      };
      ws.onclose = () => {
        document.getElementById("status").textContent = "接続が閉じられました";
      };
    };

    document.getElementById("correctButton").onclick = () => {
      document.getElementById("correctSound").play();
      buzzerPressed = false; // 正解の後にリセット
    };

    document.getElementById("wrongButton").onclick = () => {
      document.getElementById("wrongSound").play();
      buzzerPressed = false; // 不正解の後にリセット
    };

    document.getElementById("resetButton").onclick = () => {
      buzzerPressed = false;
      document.getElementById("status").textContent = "リセットしました";
    };
  </script>
</body>

</html>
