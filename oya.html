<!doctype html>
<html>
  <head>
    <title>早押しクイズ 親機</title>
  </head>

  <body>
    <h1>早押しクイズ 親機</h1>
    <button id="correctButton">正解音を鳴らす</button>
    <button id="incorrectButton">不正解音を鳴らす</button>
    <button id="resetButton">リセット</button>
    <div id="status"></div>

    <audio id="correctSound" src="assets/audio/correct1.mp3"></audio>
    <audio
      id="incorrectSound"
      src="assets/audio/Quiz-Wrong_Buzzer02-1.mp3"
    ></audio>

    <script>
      const statusDiv = document.getElementById("status");
      const correctButton = document.getElementById("correctButton");
      const incorrectButton = document.getElementById("incorrectButton");
      const resetButton = document.getElementById("resetButton");
      const correctSound = document.getElementById("correctSound");
      const incorrectSound = document.getElementById("incorrectSound");
      const ws = new WebSocket("wss://hayaoshi-quiz-backend.onrender.com");

      let firstPress = true; // 最初の押下フラグ

      ws.onopen = function () {
        statusDiv.innerHTML = "接続完了";
      };

      ws.onmessage = function (event) {
        const data = JSON.parse(event.data);
        if (data.type === "buttonPress" && firstPress) {
          statusDiv.innerHTML = `押した人: ${data.clientId}`;
          firstPress = false; // 最初の押下を記録
        }
      };

      correctButton.onclick = function () {
        ws.send(JSON.stringify({ type: "correct" }));
        correctSound.play(); // 正解音を鳴らす
      };

      incorrectButton.onclick = function () {
        ws.send(JSON.stringify({ type: "incorrect" }));
        incorrectSound.play(); // 不正解音を鳴らす
      };

      resetButton.onclick = function () {
        firstPress = true; // 押下フラグをリセット
        statusDiv.innerHTML = "リセットされました。"; // ステータスを更新
      };
    </script>
  </body>
</html>
