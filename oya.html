<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>早押しクイズ 親機</title>
</head>

<body>
  <h1>早押しクイズ 親機</h1>
  <button id="startConnection">接続開始</button>
  <button id="correct">正解音</button>
  <button id="wrong">不正解音</button>

  <p id="connectionStatus">未接続</p>
  <p id="buzzerInfo">誰も押していません</p>

  <script>
    let ws;
    let buzzerPressed = false;

    // WebSocket接続を開始
    document.getElementById('startConnection').addEventListener('click', () => {
      ws = new WebSocket('ws://hayaoshi-quiz-backend.onrender.com');

      const connectionStatus = document.getElementById('connectionStatus');
      const buzzerInfo = document.getElementById('buzzerInfo');

      ws.onopen = () => {
        connectionStatus.textContent = "接続完了";
        console.log("WebSocket connection established.");
      };

      ws.onmessage = async (event) => {
        const blob = event.data;
        const text = await blob.text();  // Blobをテキストに変換
        const data = JSON.parse(text);   // テキストをJSONに変換

        if (data.type === 'buzzer' && !buzzerPressed) {
          buzzerPressed = true;
          buzzerInfo.textContent = `${data.name} が早押ししました！`;
          console.log(`${data.name} が早押ししました！`);
        }
      };

      ws.onclose = () => {
        connectionStatus.textContent = "接続切断";
        console.log("WebSocket connection closed.");
      };
    });

    // 正解音を再生
    document.getElementById('correct').addEventListener('click', () => {
      let audio = new Audio('assets/audio/correct1.mp3');
      audio.play();
    });

    // 不正解音を再生
    document.getElementById('wrong').addEventListener('click', () => {
      let audio = new Audio('assets/audio/Quiz-Wrong_Buzzer02-1.mp3');
      audio.play();
    });
  </script>
</body>

</html>
